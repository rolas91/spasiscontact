(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[34],{c9c6:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",[a("div",{staticClass:"q-pa-md q-gutter-md"},[a("div",{staticClass:"row q-gutter-md"},[e.opcionEsVisible("btnNuevo")?a("q-btn",{staticClass:"bg-primary text-white",attrs:{to:"/admin/cursos/nuevo"}},[e._v("\n        Iniciar Nuevo Curso\n      ")]):e._e(),e.selected.length>0&&e.opcionEsVisible("btnVer")?a("q-btn",{staticClass:"bg-primary text-white",attrs:{to:"/admin/cursos/"+this.selected[0].id+"/ver"}},[e._v("\n        Ver\n      ")]):e._e(),e.selected.length>0&&e.opcionEsVisible("btnEditar")?a("q-btn",{staticClass:"bg-primary text-white",attrs:{to:"/admin/cursos/"+this.selected[0].id+"/editar"}},[e._v("\n        Editar\n      ")]):e._e(),e.selected.length>0&&e.opcionEsVisible("btnAprobar")?a("q-btn",{staticClass:"bg-indigo text-white",on:{click:function(t){return e.preguntar("aprobar")}}},[e._v("\n        Aprobar\n      ")]):e._e(),e.selected.length>0&&e.opcionEsVisible("btnCompletar")?a("q-btn",{staticClass:"bg-green text-white",on:{click:function(t){return e.preguntar("completar")}}},[e._v("\n        Marcar como completado\n      ")]):e._e(),e.selected.length>0&&e.opcionEsVisible("btnFinalizar")?a("q-btn",{staticClass:"bg-yellow text-black",on:{click:function(t){return e.preguntar("finalizar")}}},[e._v("\n        Finalizar\n      ")]):e._e(),e.selected.length>0&&e.opcionEsVisible("btnEliminar")?a("q-btn",{staticClass:"bg-negative text-white",on:{click:function(t){return e.preguntar("eliminar")}}},[e._v("\n        Eliminar\n      ")]):e._e(),e.selected.length>0&&e.opcionEsVisible("btninscripciones")?a("q-btn",{staticClass:"bg-purple text-white",attrs:{to:{name:"curso_inscripciones",params:{id:e.selected[0].id}}}},[e._v("\n        inscripciones\n      ")]):e._e(),e.selected.length>0&&e.opcionEsVisible("btnNotas")?a("q-btn",{staticClass:"bg-orange text-black",attrs:{to:"/admin/cursos/"+this.selected[0].id+"/notas"}},[e._v("\n        Notas Estudiantes\n      ")]):e._e(),a("q-btn",{staticClass:"bg-primary text-white",attrs:{icon:"autorenew"},on:{click:e.CargarCursos}})],1),a("div",{staticClass:"row q-pa-md"},[a("div",{staticClass:"col-12 col-md-5"},[1===e.id_rol||2===e.id_rol?a("q-select",{attrs:{label:"Centro",options:e.centros,"lazy-rules":"",rules:[function(e){return e||"Seleccione un Centro de estudio"}],"option-value":"id","option-label":"nombre","emit-value":"","map-options":""},on:{input:function(t){return e.CargarCursos(null,!0)}},scopedSlots:e._u([{key:"no-option",fn:function(){return[a("q-item",[a("q-item-section",{staticClass:"text-grey"},[e._v("\n                      No hay resultados disponibles\n                    ")])],1)]},proxy:!0}],null,!1,2138845739),model:{value:e.id_centro,callback:function(t){e.id_centro=t},expression:"id_centro"}}):e._e()],1)]),a("q-table",{attrs:{dense:e.$q.screen.lt.md,title:"Cursos",data:e.cursos,columns:e.columns,"row-key":"id",selection:"single",selected:e.selected,loading:e.loadingTable,pagination:e.pagination,filter:e.filtro},on:{"update:selected":function(t){e.selected=t},"update:pagination":function(t){e.pagination=t},request:e.onRequest},scopedSlots:e._u([{key:"top",fn:function(){return[a("q-btn",{attrs:{icon:"fas fa-file-excel",dense:"",color:"green",disable:e.loading,label:"Descargar Excel"},on:{click:e.descargarExcel}}),a("q-space"),a("q-input",{attrs:{placeholder:"Buscar",dense:"",debounce:"300",color:"primary"},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:e.filtro,callback:function(t){e.filtro=t},expression:"filtro"}})]},proxy:!0}])})],1),a("q-dialog",{attrs:{persistent:""},model:{value:e.confirm,callback:function(t){e.confirm=t},expression:"confirm"}},[a("q-card",[a("q-card-section",{staticClass:"row items-center"},[a("q-avatar",{attrs:{icon:"warning",color:"primary","text-color":"white"}}),a("span",{staticClass:"q-ml-sm"},[e._v(e._s(e.pregunta))])],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancelar",color:"default"},on:{click:e.cancelarAcccion}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"bg-primary text-white",attrs:{flat:"",label:"Aceptar"},on:{click:e.ejecutarAccion}})],1)],1)],1)],1)},i=[],r=(a("c5f6"),a("a34a")),o=a.n(r),s=(a("96cf"),a("c973")),c=a.n(s),l=a("bc3a"),d=a.n(l),u=a("5a9c"),p={name:"Cursos",data:function(){return{mostrar_importado:!1,confirm:!1,pregunta:"",accion:"",selected:[],visibleColumns:["id","id_centro","id_tipo","id_categoria","id_subcategoria","id_profesor","nombre","descripcion","resultado_aprendizaje","plan_estudio","id_pais","id_departamento","id_municipio","direccion","fecha_inicio","fecha_fin","id_unidad_duracion","duracion","id_estado","certificado","costo"],cursos:[],centros:[],id_centro:null,loading:!1,loadingTable:!1,filtro:"",pagination:{sortBy:"id",descending:!0,page:1,rowsPerPage:10,rowsNumber:10},columns:[{name:"codigo",required:!0,label:"Código",align:"left",field:function(e){return e.codigo},format:function(e){return"".concat(e)},sortable:!0},{name:"nombre",required:!0,label:"Nombre",align:"left",field:function(e){return e.nombre},format:function(e){return"".concat(e)},sortable:!0},{name:"centro",required:!0,label:"Centro",align:"left",field:function(e){return e.centro},format:function(e){return"".concat(e)},sortable:!0},{name:"tipo",required:!0,label:"Tipo",align:"left",field:function(e){return e.tipo},format:function(e){return"".concat(e)},sortable:!0},{name:"sector",required:!0,label:"Sector",align:"left",field:function(e){return e.sector},format:function(e){return"".concat(e)},sortable:!0},{name:"descripcion",required:!0,label:"Descripcion",align:"left",field:function(e){return e.descripcion},format:function(e){return"".concat(e)},sortable:!0},{name:"duracion",required:!0,label:"Duracion",align:"left",field:function(e){return e.duracion},format:function(e){return"".concat(e)},sortable:!0},{name:"unidad_duracion",required:!0,label:"Unidad duracion",align:"left",field:function(e){return e.unidad_duracion},format:function(e){return"".concat(e)},sortable:!0},{name:"estado",required:!0,label:"Estado",align:"left",field:function(e){return e.estado},format:function(e){return"".concat(e)},sortable:!0},{name:"fecha_inicio",required:!0,label:"Fecha inicio",align:"left",field:function(e){return e.fecha_inicio},format:function(e){return"".concat(e)},sortable:!0},{name:"fecha_fin_matricula",required:!0,label:"Fecha fin Matricula",align:"left",field:function(e){return e.fecha_fin_matricula},format:function(e){return"".concat(e)},sortable:!0}]}},created:function(){var e=this;return c()(o.a.mark((function t(){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.CargarCursos();case 3:return t.next=5,e.CargarCentros();case 5:e.loading=!1;case 6:case"end":return t.stop()}}),t)})))()},methods:{CargarCentros:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.loadingCentros=!0;var a="http://35.203.165.142/api/catalogos/centros",n={Authorization:"Bearer "+this.$store.state.token},i={filtro:t};d()({method:"get",url:a,params:i,headers:n}).then((function(t){e.centros=t.data.centros,e.loadingCentros=!1})).catch((function(t){e.loadingCentros=!1,401===t.response.status&&(e.removeCredentials(),e.$router.push({name:"login"}))}))},descargarExcel:function(){var e=this;this.loading=!0;var t="post",a="http://35.203.165.142/api/cursos/descargar",n={Authorization:"Bearer "+this.$store.state.token};d()({method:t,responseType:"blob",url:a,params:{filtro:this.filtro},headers:n}).then((function(t){e.loading=!1;var a=window.URL.createObjectURL(new Blob([t.data])),n=document.createElement("a");n.href=a,n.setAttribute("download","cursos.xlsx"),document.body.appendChild(n),n.click()})).catch((function(t){e.loading=!1,t.response.statusText,404!==t.response.status?(e.$q.notify({color:"red-5",textColor:"white",icon:"fas fa-exclamation-triangle",message:t.response.statusText}),401===t.response.status&&(e.removeCredentials(),e.$router.push({name:"login"}))):e.$q.notify({color:"red-5",textColor:"white",icon:"fas fa-exclamation-triangle",message:"Ruta no encontrada, si el error persiste contacta al administrador"})}))},cancelarAcccion:function(){this.accion="",this.pregunta=""},tienePermiso:function(e){var t=Number(this.$store.state.user.rol),a=null;switch(e){case"btnVer":a=1===t||2===t||Object(u["k"])();break;case"btnNuevo":a=1===t||2===t||Object(u["c"])();break;case"btnEditar":a=1===t||2===t||Object(u["f"])();break;case"btnAprobar":a=1===t||2===t;break;case"btnCompletar":a=1===t||2===t||Object(u["f"])();break;case"btnFinalizar":a=1===t||2===t;break;case"btnEliminar":a=1===t||2===t;break;case"btninscripciones":a=1===t||2===t||Object(u["g"])();break;case"btnNotas":a=1===t||2===t||Object(u["g"])();break;default:a=!1;break}return a},opcionEsVisible:function(e){var t=null;switch(e){case"btnVer":t=this.tienePermiso(e);break;case"btnNuevo":t=this.tienePermiso(e);break;case"btnEditar":t=this.tienePermiso(e)&&5534!==this.selected[0].id_estado&&5558!==this.selected[0].id_estado;break;case"btnAprobar":t=this.tienePermiso(e)&&5531===this.selected[0].id_estado;break;case"btnCompletar":t=this.tienePermiso(e)&&5533===this.selected[0].id_estado;break;case"btnFinalizar":t=this.tienePermiso(e)&&5534===this.selected[0].id_estado;break;case"btnEliminar":t=this.tienePermiso(e)&&5531===this.selected[0].id_estado;break;case"btninscripciones":t=this.tienePermiso(e)&&this.selected[0].id_estado>=5532;break;case"btnNotas":t=this.tienePermiso(e)&&5533===this.selected[0].id_estado;break;default:t=!1;break}return t},onRequest:function(e){this.CargarCursos(e)},preguntar:function(e){this.confirm=!0,this.pregunta="¿Estás seguro que deseas "+e+" el curso seleccionado?",this.accion=e},ejecutarAccion:function(){switch(this.accion){case"eliminar":this.eliminarCurso();break;case"aprobar":this.CambiarEstadoCurso(5532);break;case"completar":this.CambiarEstadoCurso(5534);break;case"finalizar":this.CambiarEstadoCurso(5558);break;default:break}},CambiarEstadoCurso:function(e){var t=this,a="http://35.203.165.142/api/cursos/cambiarEstado",n={Authorization:"Bearer "+this.$store.state.token};d()({method:"post",url:a,headers:n,data:{id:this.selected[0].id,id_estado:e}}).then((function(e){e.data.result?(t.$q.notify({color:"green-4",textColor:"white",icon:"fas fa-check-circle",message:"Curso actualizado correctamente",position:"bottom",timeout:2e3}),t.confirm=!1,t.CargarCursos(),t.selected=[]):t.$q.notify({color:"red-5",textColor:"white",icon:"fas fa-exclamation-triangle",message:e.data.message})})).catch((function(e){t.loading=!1,t.$q.notify({color:"red-5",textColor:"white",icon:"fas fa-exclamation-triangle",message:e.response.data}),401===e.response.status&&(t.removeCredentials(),t.$router.push({name:"login"}))}))},eliminarCurso:function(){var e=this,t="http://35.203.165.142/api/admin/cursos/"+this.selected[0].id,a={Authorization:"Bearer "+this.$store.state.token};d()({method:"delete",url:t,headers:a}).then((function(t){e.$q.notify({color:"green-4",textColor:"white",icon:"fas fa-check-circle",message:"Curso eliminado correctamente",position:"bottom",timeout:2e3}),e.modalOpen=!1,e.LimpiarDatos(),e.CargarCursos(),e.selected=[]})).catch((function(t){e.loading=!1,e.$q.notify({color:"red-5",textColor:"white",icon:"fas fa-exclamation-triangle",message:t.response.data}),401===t.response.status&&(e.removeCredentials(),e.$router.push({name:"login"}))}))},removeCredentials:function(){this.$store.dispatch("removeCredentials")},CargarCursos:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.loadingTable=!0;var n=this.pagination.rowsPerPage,i=this.pagination.page,r=this.pagination.sortBy,o=this.pagination.descending;e&&e.pagination&&(i=e.pagination.page,n=e.pagination.rowsPerPage,r=e.pagination.sortBy,o=e.pagination.descending),a&&(this.cursos=[]),this.loadingCursos=!0;var s="http://35.203.165.142/api/admin/cursos",c={Authorization:"Bearer "+this.$store.state.token};d()({method:"get",url:s,params:{rowsPerPage:n,filtro:this.filtro,page:i,sortBy:r,descending:o,mostrar_importado:this.mostrar_importado,id_centro:this.id_centro},headers:c}).then((function(e){t.loadingTable=!1,t.cursos=e.data.cursos.data,t.loadingCursos=!1,t.cursos=e.data.cursos.data,t.loading=!1,t.loadingCursos=!1,t.pagination.rowsNumber=e.data.cursos.total,t.pagination.rowsPerPage=n,t.pagination.page=e.data.cursos.current_page,t.pagination.sortBy=r,t.pagination.descending=o})).catch((function(e){t.loadingCursos=!1,t.loadingTable=!1,401===e.response.status&&(t.removeCredentials(),t.$router.push({name:"login"}))}))}},computed:{id_rol:function(){return Number(this.$store.state.user.rol)}}},f=p,b=a("2877"),m=Object(b["a"])(f,n,i,!1,null,"511cbf61",null);t["default"]=m.exports}}]);