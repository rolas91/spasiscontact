(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[41],{1476:function(t,a,e){"use strict";e.r(a);var r=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("q-page",[e("div",{staticClass:"q-pa-md q-gutter-md"},[e("div",{staticClass:"row q-gutter-md"},[e("q-btn",{staticClass:"bg-primary text-white",attrs:{icon:"autorenew"},on:{click:t.CargarBitacora}})],1),e("q-table",{attrs:{dense:t.$q.screen.lt.md,title:"Bitacora de accesos",data:t.bitacora,columns:t.columns,"row-key":"id",selection:"single",selected:t.selected,loading:t.loadingTable,pagination:t.pagination,filter:t.filtro},on:{"update:selected":function(a){t.selected=a},"update:pagination":function(a){t.pagination=a},request:t.onRequest},scopedSlots:t._u([{key:"top",fn:function(){return[e("q-btn",{attrs:{icon:"fas fa-file-excel",dense:"",color:"green",disable:t.loading,label:"Descargar Excel"},on:{click:t.descargarExcel}}),e("q-space"),e("q-input",{attrs:{placeholder:"Buscar",dense:"",debounce:"300",color:"primary"},scopedSlots:t._u([{key:"append",fn:function(){return[e("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:t.filtro,callback:function(a){t.filtro=a},expression:"filtro"}})]},proxy:!0},{key:"body",fn:function(a){return[e("q-tr",{attrs:{props:a}},[e("q-td",{attrs:{"auto-width":""}},[e("q-checkbox",{attrs:{dense:""},model:{value:a.selected,callback:function(e){t.$set(a,"selected",e)},expression:"props.selected"}})],1),e("q-td",{key:"updated_at",attrs:{props:a}},[t._v("\n            "+t._s(t.formatoFecha(a.row.updated_at))+"\n          ")]),e("q-td",{key:"id",attrs:{props:a}},[t._v(t._s(a.row.id))]),e("q-td",{key:"usuario",attrs:{props:a}},[t._v(t._s(a.row.usuario))]),e("q-td",{key:"action",attrs:{props:a}},[t._v(t._s(a.row.action))]),e("q-td",{key:"model",attrs:{props:a}},[t._v(t._s(a.row.model))]),e("q-td",{key:"id_model",attrs:{props:a}},[t._v(t._s(a.row.id_model))]),e("q-td",{key:"ip_address",attrs:{props:a}},[t._v("\n            "+t._s(a.row.ip_address)+"\n          ")]),e("q-td",{key:"user_agent",attrs:{props:a}},[t._v("\n            "+t._s(a.row.user_agent)+"\n          ")]),e("q-td",{key:"url",attrs:{props:a}},[t._v(t._s(a.row.url))])],1)]}}])})],1)])},o=[],n=e("a34a"),i=e.n(n),s=(e("96cf"),e("c973")),l=e.n(s),c=e("bc3a"),d=e.n(c),u=e("c1df"),p=e.n(u),f={data:function(){return{bitacora:[],selected:[],usuarios:[],loading:!1,loadingTable:!1,filtro:"",pagination:{sortBy:"updated_at",descending:!0,page:1,rowsPerPage:20,rowsNumber:20},columns:[{name:"updated_at",required:!0,label:"Fecha",align:"left",field:function(t){return t.updated_at},format:function(t){return"".concat(t)},sortable:!0},{name:"id",required:!0,label:"Id",align:"left",field:function(t){return t.id},format:function(t){return"".concat(t)},sortable:!0},{name:"usuario",required:!0,label:"Usuario",align:"left",field:function(t){return t.usuario},format:function(t){return"".concat(t)},sortable:!0},{name:"action",required:!0,label:"AcciÃ³n",align:"left",field:function(t){return t.action},format:function(t){return"".concat(t)},sortable:!0},{name:"model",required:!0,label:"Tabla",align:"left",field:function(t){return t.model},format:function(t){return"".concat(t)},sortable:!0},{name:"id_model",required:!0,label:"id tabla",align:"left",field:function(t){return t.id_model},format:function(t){return"".concat(t)},sortable:!0},{name:"ip_address",required:!0,label:"ip",align:"left",field:function(t){return t.ip_address},format:function(t){return"".concat(t)},sortable:!0},{name:"user_agent",required:!0,label:"Agente",align:"left",field:function(t){return t.user_agent},format:function(t){return"".concat(t)},sortable:!0},{name:"url",required:!0,label:"Url",align:"left",field:function(t){return t.url},format:function(t){return"".concat(t)},sortable:!0}]}},created:function(){var t=this;return l()(i.a.mark((function a(){return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.loading=!0,a.next=3,t.CargarBitacora();case 3:t.loading=!1;case 4:case"end":return a.stop()}}),a)})))()},methods:{descargarExcel:function(){var t=this;this.loading=!0;var a="post",e="http://35.203.165.142/api/bitacora/descargar",r={Authorization:"Bearer "+this.$store.state.token};d()({method:a,responseType:"blob",url:e,params:{filtro:this.filtro},headers:r}).then((function(a){t.loading=!1;var e=window.URL.createObjectURL(new Blob([a.data])),r=document.createElement("a");r.href=e,r.setAttribute("download","cursos.xlsx"),document.body.appendChild(r),r.click()})).catch((function(a){t.loading=!1,a.response.statusText,404!==a.response.status?(t.$q.notify({color:"red-5",textColor:"white",icon:"fas fa-exclamation-triangle",message:a.response.statusText}),401===a.response.status&&(t.removeCredentials(),t.$router.push({name:"login"}))):t.$q.notify({color:"red-5",textColor:"white",icon:"fas fa-exclamation-triangle",message:"Ruta no encontrada, si el error persiste contacta al administrador"})}))},CargarBitacora:function(t){var a=this,e=this.pagination.rowsPerPage,r=this.pagination.page;t&&t.pagination&&(r=t.pagination.page,e=t.pagination.rowsPerPage),this.loadingBitacora=!0;var o="http://35.203.165.142/api/admin/bitacora",n={Authorization:"Bearer "+this.$store.state.token};this.loadingTable=!0,d()({method:"get",url:o,params:{rowsPerPage:e,filtro:this.filtro,page:r},headers:n}).then((function(t){a.loadingTable=!1,a.loadingBitacora=!1,a.bitacora=t.data.bitacora.data,a.bitacora=t.data.bitacora.data,a.loading=!1,a.pagination.rowsNumber=t.data.bitacora.total,a.pagination.rowsPerPage=e,a.pagination.page=t.data.bitacora.current_page})).catch((function(t){a.loadingTable=!1,a.loadingBitacora=!1,401===t.response.status&&(a.removeCredentials(),a.$router.push({name:"login"}))}))},CargarUsuarios:function(t){var a=this;this.loadingTable=!0;var e=this.pagination.rowsPerPage,r=this.pagination.page;t&&t.pagination&&(e=t.pagination.rowsPerPage),this.loadingUsuarios=!0;var o="http://35.203.165.142/api/admin/usuarios",n={Authorization:"Bearer "+this.$store.state.token};d()({method:"get",url:o,params:{rowsPerPage:e,filtro:this.filtro,page:r},headers:n}).then((function(t){a.loadingTable=!1,a.usuarios=t.data.usuarios.data,a.loadingUsuarios=!1,a.usuarios=t.data.usuarios.data,a.loading=!1,a.loadingUsuarios=!1,a.pagination.rowsNumber=t.data.usuarios.total,a.pagination.rowsPerPage=e})).catch((function(t){a.loadingTable=!1,a.loadingUsuarios=!1,401===t.response.status&&(a.removeCredentials(),a.$router.push({name:"login"}))}))},onRequest:function(t){this.CargarBitacora(t)},removeCredentials:function(){this.$store.dispatch("removeCredentials")},onSubmit:function(t){var a=this,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.loading=!0;var o="post",n="http://35.203.165.142/api/admin/usuarios";this.nuevo||(n="http://35.203.165.142/api/admin/usuarios/"+this.selected[0].id,o="put");var i={Authorization:"Bearer "+this.$store.state.token};d()({method:o,url:n,data:{usuario:this.usuario,activar:e,verificar:r,centros:this.centros},headers:i}).then((function(t){a.loading=!1,t.data.result?(a.$q.notify({color:"green-4",textColor:"white",icon:"fas fa-check-circle",message:t.data.message,position:"bottom",timeout:2e3}),a.modalOpen=!1,a.LimpiarDatos(),a.CargarUsuarios(),a.selected=[]):a.$q.notify({color:"red-5",textColor:"white",icon:"fas fa-exclamation-triangle",message:t.data.message})})).catch((function(t){a.loading=!1,a.$q.notify({color:"red-5",textColor:"white",icon:"fas fa-exclamation-triangle",message:t.response.data.message}),401===t.response.status&&(a.removeCredentials(),a.$router.push({name:"login"}))}))},formatoFecha:function(t){var a=p()(t).format("DD/MM/YYYY hh:mm a");return a}},watch:{centros:{handler:function(t){this.centros.length===this.centros.filter((function(t){return t.checked})).length?this.allCentros=!0:this.centros.length>this.centros.filter((function(t){return t.checked})).length&&(this.allCentros=!1)},deep:!0}}},g=f,h=e("2877"),m=Object(h["a"])(g,r,o,!1,null,"75cbfed2",null);a["default"]=m.exports}}]);