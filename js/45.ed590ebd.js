(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[45],{ae5e:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",[a("div",{staticClass:"q-pa-md q-gutter-md"},[a("div",{staticClass:"row q-gutter-md"},[a("q-btn",{staticClass:"bg-primary text-white",on:{click:e.nuevoUsuario}},[e._v("Nuevo")]),e.selected.length>0&&"Activo"===e.selected[0].estado?a("q-btn",{staticClass:"bg-primary text-white",on:{click:e.editarUsuario}},[e._v("\n        Editar\n      ")]):e._e(),e.selected.length>0&&"Inactivo"===e.selected[0].estado?a("q-btn",{staticClass:"bg-green text-white",on:{click:e.activarUsuario}},[e._v("\n        Activar\n      ")]):e._e(),e.selected.length>0&&"No"===e.selected[0].verificado?a("q-btn",{staticClass:"bg-green text-white",on:{click:e.verificarUsuario}},[e._v("\n        Verificar\n      ")]):e._e(),e.selected.length>0&&"Activo"===e.selected[0].estado?a("q-btn",{staticClass:"bg-negative text-white",on:{click:e.pregunarEliminar}},[e._v("\n        Inactivar\n      ")]):e._e(),a("q-btn",{staticClass:"bg-primary text-white",attrs:{icon:"autorenew"},on:{click:e.CargarUsuarios}})],1),a("q-table",{attrs:{dense:e.$q.screen.lt.md,title:"Usuarios",data:e.usuarios,columns:e.columns,"row-key":"id",selection:"single",selected:e.selected,loading:e.loadingTable,pagination:e.pagination,filter:e.filtro},on:{"update:selected":function(t){e.selected=t},"update:pagination":function(t){e.pagination=t},request:e.onRequest},scopedSlots:e._u([{key:"top",fn:function(){return[a("q-btn",{attrs:{icon:"fas fa-file-excel",dense:"",color:"green",disable:e.loading,label:"Descargar Excel"},on:{click:e.descargarExcel}}),a("q-space"),a("q-input",{attrs:{placeholder:"Buscar",dense:"",debounce:"300",color:"primary"},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:e.filtro,callback:function(t){e.filtro=t},expression:"filtro"}})]},proxy:!0}])})],1),a("q-dialog",{attrs:{persistent:""},model:{value:e.modalOpen,callback:function(t){e.modalOpen=t},expression:"modalOpen"}},[a("q-card",{staticStyle:{"max-height":"70vh",width:"800px","max-width":"80vw"}},[a("q-card-section",{staticClass:"bg-primary text-white q-gutter-sm"},[a("h5",[e._v(e._s(e.nuevo?"Nuevo Usuario":"Editar Usuario"))])]),a("q-separator"),a("q-card-section",[a("q-form",{on:{submit:e.onSubmit}},[a("div",{staticClass:"row q-col-gutter-md"},[a("div",{staticClass:"col-12 col-md-4"},[a("q-input",{attrs:{color:"primary",label:"Nombre","lazy-rules":"",rules:[function(e){return e&&e.length>0&&e.length<191||"Ingrese un Nombre v치lido"}]},model:{value:e.usuario.nombre,callback:function(t){e.$set(e.usuario,"nombre",t)},expression:"usuario.nombre"}})],1),a("div",{staticClass:"col-12 col-md-4"},[a("q-input",{attrs:{color:"primary",label:"Email","lazy-rules":"",rules:[function(t){return t&&t.length>0&&t.length<191&&e.emailRegex.test(t)||"Ingrese un Email v치lido"}]},model:{value:e.usuario.email,callback:function(t){e.$set(e.usuario,"email",t)},expression:"usuario.email"}})],1),a("div",{staticClass:"col-12 col-md-4"},[5!=e.usuario.id_rol?a("q-select",{attrs:{label:"Rol",options:e.roles,"lazy-rules":"",rules:[function(e){return e||"Ingrese un Id Rol v치lido"}],"option-value":"id","option-label":"nombre","emit-value":"","map-options":""},scopedSlots:e._u([{key:"no-option",fn:function(){return[a("q-item",[a("q-item-section",{staticClass:"text-grey"},[e._v("\n                      No hay resultados disponibles\n                    ")])],1)]},proxy:!0}],null,!1,2138845739),model:{value:e.usuario.id_rol,callback:function(t){e.$set(e.usuario,"id_rol",t)},expression:"usuario.id_rol"}}):e._e()],1)]),e.$store.state.user.rol<=2?a("label",[e._v("Centros")]):e._e(),e.$store.state.user.rol<=2?a("div",{staticClass:"row q-col-gutter-lg"},[a("div",{staticClass:"col-12"},[a("q-list",{staticStyle:{"background-color":"white"},attrs:{dense:"",padding:""}},[a("q-item-label",{attrs:{header:""}},[a("q-checkbox",{on:{input:e.selectAllCentros},model:{value:e.allCentros,callback:function(t){e.allCentros=t},expression:"allCentros"}}),e._v("\n                  Todos\n                ")],1),e._l(e.centros,(function(t){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:t.nombre,attrs:{tag:"label"}},[a("q-item-section",{attrs:{side:"",top:""}},[a("q-checkbox",{model:{value:t.checked,callback:function(a){e.$set(t,"checked",a)},expression:"option.checked"}})],1),a("q-item-section",[a("q-item-label",[e._v(e._s(t.nombre))])],1)],1)}))],2)],1)]):e._e(),a("q-card-actions",{staticClass:"row justify-between q-gutter-sm"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{right:"",icon:"close"}},[e._v("Cancelar")]),a("q-btn",{staticClass:"bg-primary text-white",attrs:{loading:e.loading,disable:e.loading,right:"",type:"submit",icon:"save"}},[e._v("\n              Guardar\n            ")])],1)],1)],1)],1)],1),a("q-dialog",{attrs:{persistent:""},model:{value:e.confirm,callback:function(t){e.confirm=t},expression:"confirm"}},[a("q-card",[a("q-card-section",{staticClass:"row items-center"},[a("q-avatar",{attrs:{icon:"warning",color:"primary","text-color":"white"}}),a("span",{staticClass:"q-ml-sm"},[e._v("\n          Esta seguro que desea eliminar el usuario seleccionado?\n        ")])],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancelar",color:"default"}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"bg-primary text-white",attrs:{flat:"",label:"Aceptar"},on:{click:e.eliminarUsuario}})],1)],1)],1)],1)},o=[],r=(a("c5f6"),a("ac6a"),a("cadf"),a("06db"),a("456d"),a("a34a")),n=a.n(r),s=(a("96cf"),a("c973")),l=a.n(s),c=(a("3b2b"),a("bc3a")),u=a.n(c),d={data:function(){return{allCentros:!1,emailRegex:new RegExp(/^([a-zA-Z0-9_.-])+@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/),confirm:!1,nuevo:!0,selected:[],visibleColumns:["id","nombre","email"],usuario:{id:0,nombre:"",email:"",fecha_verificacion_email:null,remember_token:"",id_rol:null},usuarios:[],roles:[],centros:[],loading:!1,loadingRoles:!1,modalOpen:!1,loadingTable:!1,filtro:"",pagination:{sortBy:"id",descending:!0,page:1,rowsPerPage:10,rowsNumber:10},columns:[{name:"id",required:!0,label:"Id",align:"left",field:function(e){return e.id},format:function(e){return"".concat(e)},sortable:!0},{name:"nombre",required:!0,label:"Nombre",align:"left",field:function(e){return e.nombre},format:function(e){return"".concat(e)},sortable:!0},{name:"email",required:!0,label:"Email",align:"left",field:function(e){return e.email},format:function(e){return"".concat(e)},sortable:!0},{name:"centros_asignados",required:!0,label:"Centros Asignados",align:"left",field:function(e){return e.centros_asignados},format:function(e){return"".concat(e)},sortable:!0,style:"min-width:400px;width: 400px;text-overflow: ellipsis;word-break: keep-all;white-space: pre-line;height: auto;"},{name:"fecha_verificacion_email",required:!0,label:"fecha de verificaci칩n",align:"left",field:function(e){return e.fecha_verificacion_email},format:function(e){return"".concat(e)},sortable:!0},{name:"estado",required:!0,label:"Estado",align:"left",field:function(e){return e.estado},format:function(e){return"".concat(e)},sortable:!0},{name:"verificado",required:!0,label:"verificado",align:"left",field:function(e){return e.verificado},format:function(e){return"".concat(e)},sortable:!0},{name:"rol",required:!0,label:"Rol",align:"left",field:function(e){return e.rol},format:function(e){return"".concat(e)},sortable:!0}]}},created:function(){var e=this;return l()(n.a.mark((function t(){return n.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.CargarUsuarios();case 3:return t.next=5,e.CargarRoles();case 5:return t.next=7,e.CargarCentros();case 7:e.loading=!1;case 8:case"end":return t.stop()}}),t)})))()},methods:{descargarExcel:function(){var e=this;this.loading=!0;var t="post",a="http://35.203.165.142/api/usuarios/descargar",i={Authorization:"Bearer "+this.$store.state.token};u()({method:t,responseType:"blob",url:a,headers:i}).then((function(t){e.loading=!1;var a=window.URL.createObjectURL(new Blob([t.data])),i=document.createElement("a");i.href=a,i.setAttribute("download","usuarios.xlsx"),document.body.appendChild(i),i.click()})).catch((function(t){e.loading=!1,e.$q.notify({color:"red-5",textColor:"white",icon:"fas fa-exclamation-triangle",message:t.response.data}),401===t.response.status&&(e.removeCredentials(),e.$router.push({name:"login"}))}))},selectAllCentros:function(){var e=this;this.centros.forEach((function(t,a,i){i[a].checked=e.allCentros}))},verificarUsuario:function(){this.usuario=this.selected[0],this.nuevo=!1,this.onSubmit(null,!1,!0)},activarUsuario:function(){this.usuario=this.selected[0],this.nuevo=!1,this.onSubmit(null,!0)},onRequest:function(e){this.CargarUsuarios(e)},nuevoUsuario:function(){this.modalOpen=!0,this.nuevo=!0,this.LimpiarDatos()},pregunarEliminar:function(){this.confirm=!0},CargarUsuario:function(){var e=this;this.loading=!0;var t="http://35.203.165.142/api"+"/admin/usuarios/".concat(this.selected[0].id,"/edit"),a={Authorization:"Bearer "+this.$store.state.token};u()({method:"get",url:t,headers:a}).then((function(t){e.centros=t.data.centros,e.centros.forEach((function(e,t,a){0===e.checked&&(a[t].checked=!1)})),e.loading=!1})).catch((function(t){e.loading=!1,401===t.response.status&&(e.removeCredentials(),e.$router.push({name:"login"}))}))},CargarCentros:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.loadingCentros=!0;var a="http://35.203.165.142/api/catalogos/centros",i={Authorization:"Bearer "+this.$store.state.token},o={q:t};u()({method:"get",url:a,params:o,headers:i}).then((function(t){e.centros=t.data.centros,e.centros.forEach((function(e,t,a){0===e.checked&&(a[t].checked=!1)})),e.loadingCentros=!1})).catch((function(t){e.loadingCentros=!1,401===t.response.status&&(e.removeCredentials(),e.$router.push({name:"login"}))}))},eliminarUsuario:function(){var e=this,t="http://35.203.165.142/api/admin/usuarios/"+this.selected[0].id,a={Authorization:"Bearer "+this.$store.state.token};u()({method:"delete",url:t,headers:a}).then((function(t){e.$q.notify({color:"green-4",textColor:"white",icon:"fas fa-check-circle",message:"Usuario Inactivado correctamente",position:"bottom",timeout:2e3}),e.modalOpen=!1,e.LimpiarDatos(),e.CargarUsuarios(),e.selected=[]})).catch((function(t){e.loading=!1,e.$q.notify({color:"red-5",textColor:"white",icon:"fas fa-exclamation-triangle",message:t.response.data}),401===t.response.status&&(e.removeCredentials(),e.$router.push({name:"login"}))}))},editarUsuario:function(){var e=this;return l()(n.a.mark((function t(){return n.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.nuevo=!1,Object.keys(e.selected[0]).forEach((function(t){e.usuario.hasOwnProperty(t)&&(e.usuario[t]=e.selected[0][t])})),e.modalOpen=!0,t.next=5,e.CargarUsuarios();case 5:return t.next=7,e.CargarRoles();case 7:return t.next=9,e.CargarUsuario();case 9:e.usuario&&(e.usuario.id_rol=Number(e.usuario.id_rol));case 10:case"end":return t.stop()}}),t)})))()},LimpiarDatos:function(){this.usuario.id=this.usuario.nombre="",this.usuario.email="",this.usuario.fecha_verificacion_email=this.usuario.password="",this.usuario.remember_token="",this.usuario.created_at=this.usuario.updated_at=this.usuario.id_rol=null,this.centros.forEach((function(e,t,a){a[t].checked=!1}))},removeCredentials:function(){this.$store.dispatch("removeCredentials")},filtrarUsuarios:function(e,t,a){var i=this;t((function(){i.CargarUsuarios(e)}))},filtrarRoles:function(e,t,a){var i=this;t((function(){i.CargarRoles(e)}))},onSubmit:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.loading=!0;var o="post",r="http://35.203.165.142/api/admin/usuarios";this.nuevo||(r="http://35.203.165.142/api/admin/usuarios/"+this.selected[0].id,o="put");var n={Authorization:"Bearer "+this.$store.state.token};u()({method:o,url:r,data:{usuario:this.usuario,activar:a,verificar:i,centros:this.centros},headers:n}).then((function(e){t.loading=!1,e.data.result?(t.$q.notify({color:"green-4",textColor:"white",icon:"fas fa-check-circle",message:e.data.message,position:"bottom",timeout:2e3}),t.modalOpen=!1,t.LimpiarDatos(),t.CargarUsuarios(),t.selected=[]):t.$q.notify({color:"red-5",textColor:"white",icon:"fas fa-exclamation-triangle",message:e.data.message})})).catch((function(e){t.loading=!1,t.$q.notify({color:"red-5",textColor:"white",icon:"fas fa-exclamation-triangle",message:e.response.data.message}),401===e.response.status&&(t.removeCredentials(),t.$router.push({name:"login"}))}))},CargarUsuarios:function(e){var t=this;this.loadingTable=!0;var a=this.pagination.rowsPerPage,i=this.pagination.page,o=this.pagination.sortBy,r=this.pagination.descending;e&&e.pagination&&(i=e.pagination.page,a=e.pagination.rowsPerPage,o=e.pagination.sortBy,r=e.pagination.descending),this.loadingUsuarios=!0;var n="http://35.203.165.142/api/admin/usuarios",s={Authorization:"Bearer "+this.$store.state.token};u()({method:"get",url:n,params:{rowsPerPage:a,filtro:this.filtro,page:i,sortBy:o,descending:r},headers:s}).then((function(e){t.loadingTable=!1,t.usuarios=e.data.usuarios.data,t.loadingUsuarios=!1,t.usuarios=e.data.usuarios.data,t.loading=!1,t.loadingUsuarios=!1,t.pagination.rowsNumber=e.data.usuarios.total,t.pagination.rowsPerPage=a,t.pagination.page=e.data.usuarios.current_page,t.pagination.sortBy=o,t.pagination.descending=r})).catch((function(e){t.loadingTable=!1,t.loadingUsuarios=!1,401===e.response.status&&(t.removeCredentials(),t.$router.push({name:"login"}))}))},CargarRoles:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.loadingRoles=!0;var a="http://35.203.165.142/api/catalogos/roles",i={Authorization:"Bearer "+this.$store.state.token},o={q:t};u()({method:"get",url:a,params:o,headers:i}).then((function(t){e.roles=t.data.roles,e.loadingRoles=!1})).catch((function(t){e.loadingRoles=!1,401===t.response.status&&(e.removeCredentials(),e.$router.push({name:"login"}))}))}},watch:{centros:{handler:function(e){this.centros.length===this.centros.filter((function(e){return e.checked})).length?this.allCentros=!0:this.centros.length>this.centros.filter((function(e){return e.checked})).length&&(this.allCentros=!1)},deep:!0}}},h=d,m=a("2877"),g=Object(m["a"])(h,i,o,!1,null,"719ad8fc",null);t["default"]=g.exports}}]);